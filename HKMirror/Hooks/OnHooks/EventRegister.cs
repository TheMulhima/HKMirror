namespace HKMirror.Hooks.OnHooks;

/// <summary>
///     Contains different types of On Hooks for EventRegister class.<br />
///     Contains hooks that aren't generated by monomod, and before and after orig hooks for easier hooking.
/// </summary>
public static class OnEventRegister
{
    internal static class HookHandler
    {
        private static readonly List<string> HookedList = new();

        internal static void HookAwake()
        {
            if (!HookedList.Contains("Awake"))
            {
                HookedList.Add("Awake");
                On.EventRegister.Awake += Awake;
            }
        }

        internal static event Delegates.Awake_BeforeArgs _beforeAwake;
        internal static event Delegates.Awake_AfterArgs _afterAwake;

        private static void Awake(On.EventRegister.orig_Awake orig, EventRegister self)
        {
            Delegates.Params_Awake @params = new()
            {
                self = self
            };
            if (_beforeAwake != null)
                foreach (Delegates.Awake_BeforeArgs toInvoke in _beforeAwake.GetInvocationList())
                    try
                    {
                        _beforeAwake?.Invoke(@params);
                    }
                    catch (Exception e)
                    {
                        HKMirrorMod.DoLogError(e);
                    }

            self = @params.self;
            orig(self);
            if (_afterAwake != null)
                foreach (Delegates.Awake_AfterArgs toInvoke in _afterAwake.GetInvocationList())
                    try
                    {
                        _afterAwake.Invoke(@params);
                    }
                    catch (Exception e)
                    {
                        HKMirrorMod.DoLogError(e);
                    }
        }

        internal static void HookOnDestroy()
        {
            if (!HookedList.Contains("OnDestroy"))
            {
                HookedList.Add("OnDestroy");
                On.EventRegister.OnDestroy += OnDestroy;
            }
        }

        internal static event Delegates.OnDestroy_BeforeArgs _beforeOnDestroy;
        internal static event Delegates.OnDestroy_AfterArgs _afterOnDestroy;

        private static void OnDestroy(On.EventRegister.orig_OnDestroy orig, EventRegister self)
        {
            Delegates.Params_OnDestroy @params = new()
            {
                self = self
            };
            if (_beforeOnDestroy != null)
                foreach (Delegates.OnDestroy_BeforeArgs toInvoke in _beforeOnDestroy.GetInvocationList())
                    try
                    {
                        _beforeOnDestroy?.Invoke(@params);
                    }
                    catch (Exception e)
                    {
                        HKMirrorMod.DoLogError(e);
                    }

            self = @params.self;
            orig(self);
            if (_afterOnDestroy != null)
                foreach (Delegates.OnDestroy_AfterArgs toInvoke in _afterOnDestroy.GetInvocationList())
                    try
                    {
                        _afterOnDestroy.Invoke(@params);
                    }
                    catch (Exception e)
                    {
                        HKMirrorMod.DoLogError(e);
                    }
        }

        internal static void HookReceiveEvent()
        {
            if (!HookedList.Contains("ReceiveEvent"))
            {
                HookedList.Add("ReceiveEvent");
                On.EventRegister.ReceiveEvent += ReceiveEvent;
            }
        }

        internal static event Delegates.ReceiveEvent_BeforeArgs _beforeReceiveEvent;
        internal static event Delegates.ReceiveEvent_AfterArgs _afterReceiveEvent;

        private static void ReceiveEvent(On.EventRegister.orig_ReceiveEvent orig, EventRegister self)
        {
            Delegates.Params_ReceiveEvent @params = new()
            {
                self = self
            };
            if (_beforeReceiveEvent != null)
                foreach (Delegates.ReceiveEvent_BeforeArgs toInvoke in _beforeReceiveEvent.GetInvocationList())
                    try
                    {
                        _beforeReceiveEvent?.Invoke(@params);
                    }
                    catch (Exception e)
                    {
                        HKMirrorMod.DoLogError(e);
                    }

            self = @params.self;
            orig(self);
            if (_afterReceiveEvent != null)
                foreach (Delegates.ReceiveEvent_AfterArgs toInvoke in _afterReceiveEvent.GetInvocationList())
                    try
                    {
                        _afterReceiveEvent.Invoke(@params);
                    }
                    catch (Exception e)
                    {
                        HKMirrorMod.DoLogError(e);
                    }
        }

        internal static void HookSwitchEvent()
        {
            if (!HookedList.Contains("SwitchEvent"))
            {
                HookedList.Add("SwitchEvent");
                On.EventRegister.SwitchEvent += SwitchEvent;
            }
        }

        internal static event Delegates.SwitchEvent_BeforeArgs _beforeSwitchEvent;
        internal static event Delegates.SwitchEvent_AfterArgs _afterSwitchEvent;

        private static void SwitchEvent(On.EventRegister.orig_SwitchEvent orig, EventRegister self, string eventName)
        {
            Delegates.Params_SwitchEvent @params = new()
            {
                self = self, eventName = eventName
            };
            if (_beforeSwitchEvent != null)
                foreach (Delegates.SwitchEvent_BeforeArgs toInvoke in _beforeSwitchEvent.GetInvocationList())
                    try
                    {
                        _beforeSwitchEvent?.Invoke(@params);
                    }
                    catch (Exception e)
                    {
                        HKMirrorMod.DoLogError(e);
                    }

            self = @params.self;
            eventName = @params.eventName;
            orig(self, eventName);
            if (_afterSwitchEvent != null)
                foreach (Delegates.SwitchEvent_AfterArgs toInvoke in _afterSwitchEvent.GetInvocationList())
                    try
                    {
                        _afterSwitchEvent.Invoke(@params);
                    }
                    catch (Exception e)
                    {
                        HKMirrorMod.DoLogError(e);
                    }
        }

        internal static void HookSendEvent()
        {
            if (!HookedList.Contains("SendEvent"))
            {
                HookedList.Add("SendEvent");
                On.EventRegister.SendEvent += SendEvent;
            }
        }

        internal static event Delegates.SendEvent_BeforeArgs _beforeSendEvent;
        internal static event Delegates.SendEvent_AfterArgs _afterSendEvent;

        private static void SendEvent(On.EventRegister.orig_SendEvent orig, string eventName)
        {
            Delegates.Params_SendEvent @params = new()
            {
                eventName = eventName
            };
            if (_beforeSendEvent != null)
                foreach (Delegates.SendEvent_BeforeArgs toInvoke in _beforeSendEvent.GetInvocationList())
                    try
                    {
                        _beforeSendEvent?.Invoke(@params);
                    }
                    catch (Exception e)
                    {
                        HKMirrorMod.DoLogError(e);
                    }

            eventName = @params.eventName;
            orig(eventName);
            if (_afterSendEvent != null)
                foreach (Delegates.SendEvent_AfterArgs toInvoke in _afterSendEvent.GetInvocationList())
                    try
                    {
                        _afterSendEvent.Invoke(@params);
                    }
                    catch (Exception e)
                    {
                        HKMirrorMod.DoLogError(e);
                    }
        }

        internal static void HookSubscribeEvent()
        {
            if (!HookedList.Contains("SubscribeEvent"))
            {
                HookedList.Add("SubscribeEvent");
                On.EventRegister.SubscribeEvent += SubscribeEvent;
            }
        }

        internal static event Delegates.SubscribeEvent_BeforeArgs _beforeSubscribeEvent;
        internal static event Delegates.SubscribeEvent_AfterArgs _afterSubscribeEvent;

        private static void SubscribeEvent(On.EventRegister.orig_SubscribeEvent orig, EventRegister register)
        {
            Delegates.Params_SubscribeEvent @params = new()
            {
                register = register
            };
            if (_beforeSubscribeEvent != null)
                foreach (Delegates.SubscribeEvent_BeforeArgs toInvoke in _beforeSubscribeEvent.GetInvocationList())
                    try
                    {
                        _beforeSubscribeEvent?.Invoke(@params);
                    }
                    catch (Exception e)
                    {
                        HKMirrorMod.DoLogError(e);
                    }

            register = @params.register;
            orig(register);
            if (_afterSubscribeEvent != null)
                foreach (Delegates.SubscribeEvent_AfterArgs toInvoke in _afterSubscribeEvent.GetInvocationList())
                    try
                    {
                        _afterSubscribeEvent.Invoke(@params);
                    }
                    catch (Exception e)
                    {
                        HKMirrorMod.DoLogError(e);
                    }
        }

        internal static void HookUnsubscribeEvent()
        {
            if (!HookedList.Contains("UnsubscribeEvent"))
            {
                HookedList.Add("UnsubscribeEvent");
                On.EventRegister.UnsubscribeEvent += UnsubscribeEvent;
            }
        }

        internal static event Delegates.UnsubscribeEvent_BeforeArgs _beforeUnsubscribeEvent;
        internal static event Delegates.UnsubscribeEvent_AfterArgs _afterUnsubscribeEvent;

        private static void UnsubscribeEvent(On.EventRegister.orig_UnsubscribeEvent orig, EventRegister register)
        {
            Delegates.Params_UnsubscribeEvent @params = new()
            {
                register = register
            };
            if (_beforeUnsubscribeEvent != null)
                foreach (Delegates.UnsubscribeEvent_BeforeArgs toInvoke in _beforeUnsubscribeEvent.GetInvocationList())
                    try
                    {
                        _beforeUnsubscribeEvent?.Invoke(@params);
                    }
                    catch (Exception e)
                    {
                        HKMirrorMod.DoLogError(e);
                    }

            register = @params.register;
            orig(register);
            if (_afterUnsubscribeEvent != null)
                foreach (Delegates.UnsubscribeEvent_AfterArgs toInvoke in _afterUnsubscribeEvent.GetInvocationList())
                    try
                    {
                        _afterUnsubscribeEvent.Invoke(@params);
                    }
                    catch (Exception e)
                    {
                        HKMirrorMod.DoLogError(e);
                    }
        }
    }

    /// <summary>
    ///     Contains necessary information to create Hooks. Does not contain any hooks
    /// </summary>
    public static class Delegates
    {
        public delegate void Awake_AfterArgs(Params_Awake args);

        public delegate void Awake_BeforeArgs(Params_Awake args);

        public delegate void Awake_WithArgs(Action<EventRegister> orig, EventRegister self);

        public delegate void OnDestroy_AfterArgs(Params_OnDestroy args);

        public delegate void OnDestroy_BeforeArgs(Params_OnDestroy args);

        public delegate void OnDestroy_WithArgs(Action<EventRegister> orig, EventRegister self);

        public delegate void ReceiveEvent_AfterArgs(Params_ReceiveEvent args);

        public delegate void ReceiveEvent_BeforeArgs(Params_ReceiveEvent args);

        public delegate void ReceiveEvent_WithArgs(Action<EventRegister> orig, EventRegister self);

        public delegate void SendEvent_AfterArgs(Params_SendEvent args);

        public delegate void SendEvent_BeforeArgs(Params_SendEvent args);

        public delegate void SendEvent_WithArgs(Action<string> orig, string eventName);

        public delegate void SubscribeEvent_AfterArgs(Params_SubscribeEvent args);

        public delegate void SubscribeEvent_BeforeArgs(Params_SubscribeEvent args);

        public delegate void SubscribeEvent_WithArgs(Action<EventRegister> orig, EventRegister register);

        public delegate void SwitchEvent_AfterArgs(Params_SwitchEvent args);

        public delegate void SwitchEvent_BeforeArgs(Params_SwitchEvent args);

        public delegate void SwitchEvent_WithArgs(Action<EventRegister, string> orig, EventRegister self,
            string eventName);

        public delegate void UnsubscribeEvent_AfterArgs(Params_UnsubscribeEvent args);

        public delegate void UnsubscribeEvent_BeforeArgs(Params_UnsubscribeEvent args);

        public delegate void UnsubscribeEvent_WithArgs(Action<EventRegister> orig, EventRegister register);

        public sealed class Params_Awake
        {
            public EventRegister self;
        }

        public sealed class Params_OnDestroy
        {
            public EventRegister self;
        }

        public sealed class Params_ReceiveEvent
        {
            public EventRegister self;
        }

        public sealed class Params_SwitchEvent
        {
            public string eventName;
            public EventRegister self;
        }

        public sealed class Params_SendEvent
        {
            public string eventName;
        }

        public sealed class Params_SubscribeEvent
        {
            public EventRegister register;
        }

        public sealed class Params_UnsubscribeEvent
        {
            public EventRegister register;
        }
    }

    /// <summary>
    ///     Contains Hooks to that run code before orig(self) is called
    /// </summary>
    public static class BeforeOrig
    {
        public static event Delegates.Awake_BeforeArgs Awake
        {
            add
            {
                HookHandler._beforeAwake += value;
                HookHandler.HookAwake();
            }
            remove => HookHandler._beforeAwake -= value;
        }

        public static event Delegates.OnDestroy_BeforeArgs OnDestroy
        {
            add
            {
                HookHandler._beforeOnDestroy += value;
                HookHandler.HookOnDestroy();
            }
            remove => HookHandler._beforeOnDestroy -= value;
        }

        public static event Delegates.ReceiveEvent_BeforeArgs ReceiveEvent
        {
            add
            {
                HookHandler._beforeReceiveEvent += value;
                HookHandler.HookReceiveEvent();
            }
            remove => HookHandler._beforeReceiveEvent -= value;
        }

        public static event Delegates.SwitchEvent_BeforeArgs SwitchEvent
        {
            add
            {
                HookHandler._beforeSwitchEvent += value;
                HookHandler.HookSwitchEvent();
            }
            remove => HookHandler._beforeSwitchEvent -= value;
        }

        public static event Delegates.SendEvent_BeforeArgs SendEvent
        {
            add
            {
                HookHandler._beforeSendEvent += value;
                HookHandler.HookSendEvent();
            }
            remove => HookHandler._beforeSendEvent -= value;
        }

        public static event Delegates.SubscribeEvent_BeforeArgs SubscribeEvent
        {
            add
            {
                HookHandler._beforeSubscribeEvent += value;
                HookHandler.HookSubscribeEvent();
            }
            remove => HookHandler._beforeSubscribeEvent -= value;
        }

        public static event Delegates.UnsubscribeEvent_BeforeArgs UnsubscribeEvent
        {
            add
            {
                HookHandler._beforeUnsubscribeEvent += value;
                HookHandler.HookUnsubscribeEvent();
            }
            remove => HookHandler._beforeUnsubscribeEvent -= value;
        }
    }

    /// <summary>
    ///     Contains Hooks to that run code after orig(self) is called
    /// </summary>
    public static class AfterOrig
    {
        public static event Delegates.Awake_AfterArgs Awake
        {
            add
            {
                HookHandler._afterAwake += value;
                HookHandler.HookAwake();
            }
            remove => HookHandler._afterAwake -= value;
        }

        public static event Delegates.OnDestroy_AfterArgs OnDestroy
        {
            add
            {
                HookHandler._afterOnDestroy += value;
                HookHandler.HookOnDestroy();
            }
            remove => HookHandler._afterOnDestroy -= value;
        }

        public static event Delegates.ReceiveEvent_AfterArgs ReceiveEvent
        {
            add
            {
                HookHandler._afterReceiveEvent += value;
                HookHandler.HookReceiveEvent();
            }
            remove => HookHandler._afterReceiveEvent -= value;
        }

        public static event Delegates.SwitchEvent_AfterArgs SwitchEvent
        {
            add
            {
                HookHandler._afterSwitchEvent += value;
                HookHandler.HookSwitchEvent();
            }
            remove => HookHandler._afterSwitchEvent -= value;
        }

        public static event Delegates.SendEvent_AfterArgs SendEvent
        {
            add
            {
                HookHandler._afterSendEvent += value;
                HookHandler.HookSendEvent();
            }
            remove => HookHandler._afterSendEvent -= value;
        }

        public static event Delegates.SubscribeEvent_AfterArgs SubscribeEvent
        {
            add
            {
                HookHandler._afterSubscribeEvent += value;
                HookHandler.HookSubscribeEvent();
            }
            remove => HookHandler._afterSubscribeEvent -= value;
        }

        public static event Delegates.UnsubscribeEvent_AfterArgs UnsubscribeEvent
        {
            add
            {
                HookHandler._afterUnsubscribeEvent += value;
                HookHandler.HookUnsubscribeEvent();
            }
            remove => HookHandler._afterUnsubscribeEvent -= value;
        }
    }

    /// <summary>
    ///     Contains all On Hooks, even those that aren't in the On namespace such as API generated functions and property
    ///     getters/setters
    /// </summary>
    public static class WithOrig
    {
        public static event On.EventRegister.hook_Awake Awake
        {
            add => On.EventRegister.Awake += value;
            remove => On.EventRegister.Awake -= value;
        }

        public static event On.EventRegister.hook_OnDestroy OnDestroy
        {
            add => On.EventRegister.OnDestroy += value;
            remove => On.EventRegister.OnDestroy -= value;
        }

        public static event On.EventRegister.hook_ReceiveEvent ReceiveEvent
        {
            add => On.EventRegister.ReceiveEvent += value;
            remove => On.EventRegister.ReceiveEvent -= value;
        }

        public static event On.EventRegister.hook_SwitchEvent SwitchEvent
        {
            add => On.EventRegister.SwitchEvent += value;
            remove => On.EventRegister.SwitchEvent -= value;
        }

        public static event On.EventRegister.hook_SendEvent SendEvent
        {
            add => On.EventRegister.SendEvent += value;
            remove => On.EventRegister.SendEvent -= value;
        }

        public static event On.EventRegister.hook_SubscribeEvent SubscribeEvent
        {
            add => On.EventRegister.SubscribeEvent += value;
            remove => On.EventRegister.SubscribeEvent -= value;
        }

        public static event On.EventRegister.hook_UnsubscribeEvent UnsubscribeEvent
        {
            add => On.EventRegister.UnsubscribeEvent += value;
            remove => On.EventRegister.UnsubscribeEvent -= value;
        }
    }
}