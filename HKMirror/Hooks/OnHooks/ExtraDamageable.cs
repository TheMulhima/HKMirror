namespace HKMirror.Hooks.OnHooks;

/// <summary>
///     Contains different types of On Hooks for ExtraDamageable class.<br />
///     Contains hooks that aren't generated by monomod, and before and after orig hooks for easier hooking.
/// </summary>
public static class OnExtraDamageable
{
    internal static class HookHandler
    {
        private static readonly List<string> HookedList = new();

        internal static void HookAwake()
        {
            if (!HookedList.Contains("Awake"))
            {
                HookedList.Add("Awake");
                On.ExtraDamageable.Awake += Awake;
            }
        }

        internal static event Delegates.Awake_BeforeArgs _beforeAwake;
        internal static event Delegates.Awake_NormalArgs _afterAwake;

        private static void Awake(On.ExtraDamageable.orig_Awake orig, ExtraDamageable self)
        {
            Delegates.Params_Awake @params = new()
            {
                self = self
            };
            _beforeAwake?.Invoke(@params);
            self = @params.self;
            orig(self);
            if (_afterAwake != null) _afterAwake.Invoke(@params);
        }

        internal static void HookLateUpdate()
        {
            if (!HookedList.Contains("LateUpdate"))
            {
                HookedList.Add("LateUpdate");
                On.ExtraDamageable.LateUpdate += LateUpdate;
            }
        }

        internal static event Delegates.LateUpdate_BeforeArgs _beforeLateUpdate;
        internal static event Delegates.LateUpdate_NormalArgs _afterLateUpdate;

        private static void LateUpdate(On.ExtraDamageable.orig_LateUpdate orig, ExtraDamageable self)
        {
            Delegates.Params_LateUpdate @params = new()
            {
                self = self
            };
            _beforeLateUpdate?.Invoke(@params);
            self = @params.self;
            orig(self);
            if (_afterLateUpdate != null) _afterLateUpdate.Invoke(@params);
        }

        internal static void HookRecieveExtraDamage()
        {
            if (!HookedList.Contains("RecieveExtraDamage"))
            {
                HookedList.Add("RecieveExtraDamage");
                On.ExtraDamageable.RecieveExtraDamage += RecieveExtraDamage;
            }
        }

        internal static event Delegates.RecieveExtraDamage_BeforeArgs _beforeRecieveExtraDamage;
        internal static event Delegates.RecieveExtraDamage_NormalArgs _afterRecieveExtraDamage;

        private static void RecieveExtraDamage(On.ExtraDamageable.orig_RecieveExtraDamage orig, ExtraDamageable self,
            ExtraDamageTypes extraDamageType)
        {
            Delegates.Params_RecieveExtraDamage @params = new()
            {
                self = self, extraDamageType = extraDamageType
            };
            _beforeRecieveExtraDamage?.Invoke(@params);
            self = @params.self;
            extraDamageType = @params.extraDamageType;
            orig(self, extraDamageType);
            if (_afterRecieveExtraDamage != null) _afterRecieveExtraDamage.Invoke(@params);
        }

        internal static void HookGetDamageOfType()
        {
            if (!HookedList.Contains("GetDamageOfType"))
            {
                HookedList.Add("GetDamageOfType");
                On.ExtraDamageable.GetDamageOfType += GetDamageOfType;
            }
        }

        internal static event Delegates.GetDamageOfType_BeforeArgs _beforeGetDamageOfType;
        internal static event Delegates.GetDamageOfType_NormalArgs _afterGetDamageOfType;

        private static int GetDamageOfType(On.ExtraDamageable.orig_GetDamageOfType orig,
            ExtraDamageTypes extraDamageTypes)
        {
            Delegates.Params_GetDamageOfType @params = new()
            {
                extraDamageTypes = extraDamageTypes
            };
            _beforeGetDamageOfType?.Invoke(@params);
            extraDamageTypes = @params.extraDamageTypes;
            var retVal = orig(extraDamageTypes);
            if (_afterGetDamageOfType != null) retVal = _afterGetDamageOfType.Invoke(@params);
            return retVal;
        }

        internal static void HookApplyExtraDamageToHealthManager()
        {
            if (!HookedList.Contains("ApplyExtraDamageToHealthManager"))
            {
                HookedList.Add("ApplyExtraDamageToHealthManager");
                On.ExtraDamageable.ApplyExtraDamageToHealthManager += ApplyExtraDamageToHealthManager;
            }
        }

        internal static event Delegates.ApplyExtraDamageToHealthManager_BeforeArgs
            _beforeApplyExtraDamageToHealthManager;

        internal static event Delegates.ApplyExtraDamageToHealthManager_NormalArgs
            _afterApplyExtraDamageToHealthManager;

        private static void ApplyExtraDamageToHealthManager(
            On.ExtraDamageable.orig_ApplyExtraDamageToHealthManager orig, ExtraDamageable self, int damageAmount)
        {
            Delegates.Params_ApplyExtraDamageToHealthManager @params = new()
            {
                self = self, damageAmount = damageAmount
            };
            _beforeApplyExtraDamageToHealthManager?.Invoke(@params);
            self = @params.self;
            damageAmount = @params.damageAmount;
            orig(self, damageAmount);
            if (_afterApplyExtraDamageToHealthManager != null) _afterApplyExtraDamageToHealthManager.Invoke(@params);
        }
    }

    /// <summary>
    ///     Contains necessary information to create Hooks. Does not contain any hooks
    /// </summary>
    public static class Delegates
    {
        public delegate void ApplyExtraDamageToHealthManager_BeforeArgs(Params_ApplyExtraDamageToHealthManager args);

        public delegate void ApplyExtraDamageToHealthManager_NormalArgs(Params_ApplyExtraDamageToHealthManager args);

        public delegate void Awake_BeforeArgs(Params_Awake args);

        public delegate void Awake_NormalArgs(Params_Awake args);

        public delegate void GetDamageOfType_BeforeArgs(Params_GetDamageOfType args);

        public delegate int GetDamageOfType_NormalArgs(Params_GetDamageOfType args);

        public delegate void LateUpdate_BeforeArgs(Params_LateUpdate args);

        public delegate void LateUpdate_NormalArgs(Params_LateUpdate args);

        public delegate void RecieveExtraDamage_BeforeArgs(Params_RecieveExtraDamage args);

        public delegate void RecieveExtraDamage_NormalArgs(Params_RecieveExtraDamage args);

        public sealed class Params_Awake
        {
            public ExtraDamageable self;
        }

        public sealed class Params_LateUpdate
        {
            public ExtraDamageable self;
        }

        public sealed class Params_RecieveExtraDamage
        {
            public ExtraDamageTypes extraDamageType;
            public ExtraDamageable self;
        }

        public sealed class Params_GetDamageOfType
        {
            public ExtraDamageTypes extraDamageTypes;
        }

        public sealed class Params_ApplyExtraDamageToHealthManager
        {
            public int damageAmount;
            public ExtraDamageable self;
        }
    }

    /// <summary>
    ///     Contains Hooks to that run code before orig(self) is called
    /// </summary>
    public static class BeforeOrig
    {
        public static event Delegates.Awake_BeforeArgs Awake
        {
            add
            {
                HookHandler._beforeAwake += value;
                HookHandler.HookAwake();
            }
            remove => HookHandler._beforeAwake -= value;
        }

        public static event Delegates.LateUpdate_BeforeArgs LateUpdate
        {
            add
            {
                HookHandler._beforeLateUpdate += value;
                HookHandler.HookLateUpdate();
            }
            remove => HookHandler._beforeLateUpdate -= value;
        }

        public static event Delegates.RecieveExtraDamage_BeforeArgs RecieveExtraDamage
        {
            add
            {
                HookHandler._beforeRecieveExtraDamage += value;
                HookHandler.HookRecieveExtraDamage();
            }
            remove => HookHandler._beforeRecieveExtraDamage -= value;
        }

        public static event Delegates.GetDamageOfType_BeforeArgs GetDamageOfType
        {
            add
            {
                HookHandler._beforeGetDamageOfType += value;
                HookHandler.HookGetDamageOfType();
            }
            remove => HookHandler._beforeGetDamageOfType -= value;
        }

        public static event Delegates.ApplyExtraDamageToHealthManager_BeforeArgs ApplyExtraDamageToHealthManager
        {
            add
            {
                HookHandler._beforeApplyExtraDamageToHealthManager += value;
                HookHandler.HookApplyExtraDamageToHealthManager();
            }
            remove => HookHandler._beforeApplyExtraDamageToHealthManager -= value;
        }
    }

    /// <summary>
    ///     Contains Hooks to that run code after orig(self) is called
    /// </summary>
    public static class AfterOrig
    {
        public static event Delegates.Awake_NormalArgs Awake
        {
            add
            {
                HookHandler._afterAwake += value;
                HookHandler.HookAwake();
            }
            remove => HookHandler._afterAwake -= value;
        }

        public static event Delegates.LateUpdate_NormalArgs LateUpdate
        {
            add
            {
                HookHandler._afterLateUpdate += value;
                HookHandler.HookLateUpdate();
            }
            remove => HookHandler._afterLateUpdate -= value;
        }

        public static event Delegates.RecieveExtraDamage_NormalArgs RecieveExtraDamage
        {
            add
            {
                HookHandler._afterRecieveExtraDamage += value;
                HookHandler.HookRecieveExtraDamage();
            }
            remove => HookHandler._afterRecieveExtraDamage -= value;
        }

        public static event Delegates.GetDamageOfType_NormalArgs GetDamageOfType
        {
            add
            {
                HookHandler._afterGetDamageOfType += value;
                HookHandler.HookGetDamageOfType();
            }
            remove => HookHandler._afterGetDamageOfType -= value;
        }

        public static event Delegates.ApplyExtraDamageToHealthManager_NormalArgs ApplyExtraDamageToHealthManager
        {
            add
            {
                HookHandler._afterApplyExtraDamageToHealthManager += value;
                HookHandler.HookApplyExtraDamageToHealthManager();
            }
            remove => HookHandler._afterApplyExtraDamageToHealthManager -= value;
        }
    }

    /// <summary>
    ///     Contains all On Hooks, even those that aren't in the On namespace such as API generated functions and property
    ///     getters/setters
    /// </summary>
    public static class WithOrig
    {
        public static event On.ExtraDamageable.hook_Awake Awake
        {
            add => On.ExtraDamageable.Awake += value;
            remove => On.ExtraDamageable.Awake -= value;
        }

        public static event On.ExtraDamageable.hook_LateUpdate LateUpdate
        {
            add => On.ExtraDamageable.LateUpdate += value;
            remove => On.ExtraDamageable.LateUpdate -= value;
        }

        public static event On.ExtraDamageable.hook_RecieveExtraDamage RecieveExtraDamage
        {
            add => On.ExtraDamageable.RecieveExtraDamage += value;
            remove => On.ExtraDamageable.RecieveExtraDamage -= value;
        }

        public static event On.ExtraDamageable.hook_GetDamageOfType GetDamageOfType
        {
            add => On.ExtraDamageable.GetDamageOfType += value;
            remove => On.ExtraDamageable.GetDamageOfType -= value;
        }

        public static event On.ExtraDamageable.hook_ApplyExtraDamageToHealthManager ApplyExtraDamageToHealthManager
        {
            add => On.ExtraDamageable.ApplyExtraDamageToHealthManager += value;
            remove => On.ExtraDamageable.ApplyExtraDamageToHealthManager -= value;
        }
    }
}