namespace HKMirror.Hooks.OnHooks;

/// <summary>
///     Contains different types of On Hooks for iTweenFSMEvents class.<br />
///     Contains hooks that aren't generated by monomod, and before and after orig hooks for easier hooking.
/// </summary>
public static class OniTweenFSMEvents
{
    internal static class HookHandler
    {
        private static readonly List<string> HookedList = new();

        internal static void HookiTweenOnStart()
        {
            if (!HookedList.Contains("iTweenOnStart"))
            {
                HookedList.Add("iTweenOnStart");
                On.iTweenFSMEvents.iTweenOnStart += iTweenOnStart;
            }
        }

        internal static event Delegates.iTweenOnStart_BeforeArgs _beforeiTweenOnStart;
        internal static event Delegates.iTweenOnStart_NormalArgs _afteriTweenOnStart;

        private static void iTweenOnStart(On.iTweenFSMEvents.orig_iTweenOnStart orig, iTweenFSMEvents self,
            int aniTweenID)
        {
            Delegates.Params_iTweenOnStart @params = new()
            {
                self = self, aniTweenID = aniTweenID
            };
            _beforeiTweenOnStart?.Invoke(@params);
            self = @params.self;
            aniTweenID = @params.aniTweenID;
            orig(self, aniTweenID);
            if (_afteriTweenOnStart != null) _afteriTweenOnStart.Invoke(@params);
        }

        internal static void HookiTweenOnComplete()
        {
            if (!HookedList.Contains("iTweenOnComplete"))
            {
                HookedList.Add("iTweenOnComplete");
                On.iTweenFSMEvents.iTweenOnComplete += iTweenOnComplete;
            }
        }

        internal static event Delegates.iTweenOnComplete_BeforeArgs _beforeiTweenOnComplete;
        internal static event Delegates.iTweenOnComplete_NormalArgs _afteriTweenOnComplete;

        private static void iTweenOnComplete(On.iTweenFSMEvents.orig_iTweenOnComplete orig, iTweenFSMEvents self,
            int aniTweenID)
        {
            Delegates.Params_iTweenOnComplete @params = new()
            {
                self = self, aniTweenID = aniTweenID
            };
            _beforeiTweenOnComplete?.Invoke(@params);
            self = @params.self;
            aniTweenID = @params.aniTweenID;
            orig(self, aniTweenID);
            if (_afteriTweenOnComplete != null) _afteriTweenOnComplete.Invoke(@params);
        }
    }

    /// <summary>
    ///     Contains necessary information to create Hooks. Does not contain any hooks
    /// </summary>
    public static class Delegates
    {
        public delegate void iTweenOnComplete_BeforeArgs(Params_iTweenOnComplete args);

        public delegate void iTweenOnComplete_NormalArgs(Params_iTweenOnComplete args);

        public delegate void iTweenOnStart_BeforeArgs(Params_iTweenOnStart args);

        public delegate void iTweenOnStart_NormalArgs(Params_iTweenOnStart args);

        public sealed class Params_iTweenOnStart
        {
            public int aniTweenID;
            public iTweenFSMEvents self;
        }

        public sealed class Params_iTweenOnComplete
        {
            public int aniTweenID;
            public iTweenFSMEvents self;
        }
    }

    /// <summary>
    ///     Contains Hooks to that run code before orig(self) is called
    /// </summary>
    public static class BeforeOrig
    {
        public static event Delegates.iTweenOnStart_BeforeArgs iTweenOnStart
        {
            add
            {
                HookHandler._beforeiTweenOnStart += value;
                HookHandler.HookiTweenOnStart();
            }
            remove => HookHandler._beforeiTweenOnStart -= value;
        }

        public static event Delegates.iTweenOnComplete_BeforeArgs iTweenOnComplete
        {
            add
            {
                HookHandler._beforeiTweenOnComplete += value;
                HookHandler.HookiTweenOnComplete();
            }
            remove => HookHandler._beforeiTweenOnComplete -= value;
        }
    }

    /// <summary>
    ///     Contains Hooks to that run code after orig(self) is called
    /// </summary>
    public static class AfterOrig
    {
        public static event Delegates.iTweenOnStart_NormalArgs iTweenOnStart
        {
            add
            {
                HookHandler._afteriTweenOnStart += value;
                HookHandler.HookiTweenOnStart();
            }
            remove => HookHandler._afteriTweenOnStart -= value;
        }

        public static event Delegates.iTweenOnComplete_NormalArgs iTweenOnComplete
        {
            add
            {
                HookHandler._afteriTweenOnComplete += value;
                HookHandler.HookiTweenOnComplete();
            }
            remove => HookHandler._afteriTweenOnComplete -= value;
        }
    }

    /// <summary>
    ///     Contains all On Hooks, even those that aren't in the On namespace such as API generated functions and property
    ///     getters/setters
    /// </summary>
    public static class WithOrig
    {
        public static event On.iTweenFSMEvents.hook_iTweenOnStart iTweenOnStart
        {
            add => On.iTweenFSMEvents.iTweenOnStart += value;
            remove => On.iTweenFSMEvents.iTweenOnStart -= value;
        }

        public static event On.iTweenFSMEvents.hook_iTweenOnComplete iTweenOnComplete
        {
            add => On.iTweenFSMEvents.iTweenOnComplete += value;
            remove => On.iTweenFSMEvents.iTweenOnComplete -= value;
        }
    }
}