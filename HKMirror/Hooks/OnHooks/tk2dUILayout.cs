using MonoMod.RuntimeDetour;
using MonoMod.RuntimeDetour.HookGen;

namespace HKMirror.Hooks.OnHooks;

/// <summary>
///     Contains different types of On Hooks for tk2dUILayout class.<br />
///     Contains hooks that aren't generated by monomod, and before and after orig hooks for easier hooking.
/// </summary>
public static class Ontk2dUILayout
{
    internal static class HookHandler
    {
        private static readonly List<string> HookedList = new();

        internal static void Hookget_ItemCount()
        {
            if (!HookedList.Contains("get_ItemCount"))
            {
                HookedList.Add("get_ItemCount");
                new Hook(ReflectionHelper.GetMethodInfo(typeof(tk2dUILayout), "get_ItemCount"), get_ItemCount);
            }
        }

        internal static event Delegates.get_ItemCount_BeforeArgs _beforeget_ItemCount;
        internal static event Delegates.get_ItemCount_AfterArgs _afterget_ItemCount;

        private static int get_ItemCount(Func<tk2dUILayout, int> orig, tk2dUILayout self)
        {
            Delegates.Params_get_ItemCount @params = new()
            {
                self = self
            };
            if (_beforeget_ItemCount != null)
                foreach (Delegates.get_ItemCount_BeforeArgs toInvoke in _beforeget_ItemCount.GetInvocationList())
                    try
                    {
                        _beforeget_ItemCount?.Invoke(@params);
                    }
                    catch (Exception e)
                    {
                        HKMirrorMod.DoLogError(e);
                    }

            self = @params.self;
            var retVal = orig(self);
            if (_afterget_ItemCount != null)
                foreach (Delegates.get_ItemCount_AfterArgs toInvoke in _afterget_ItemCount.GetInvocationList())
                    try
                    {
                        retVal = _afterget_ItemCount.Invoke(@params, retVal);
                    }
                    catch (Exception e)
                    {
                        HKMirrorMod.DoLogError(e);
                    }

            return retVal;
        }

        internal static void HookReset()
        {
            if (!HookedList.Contains("Reset"))
            {
                HookedList.Add("Reset");
                On.tk2dUILayout.Reset += Reset;
            }
        }

        internal static event Delegates.Reset_BeforeArgs _beforeReset;
        internal static event Delegates.Reset_AfterArgs _afterReset;

        private static void Reset(On.tk2dUILayout.orig_Reset orig, tk2dUILayout self)
        {
            Delegates.Params_Reset @params = new()
            {
                self = self
            };
            if (_beforeReset != null)
                foreach (Delegates.Reset_BeforeArgs toInvoke in _beforeReset.GetInvocationList())
                    try
                    {
                        _beforeReset?.Invoke(@params);
                    }
                    catch (Exception e)
                    {
                        HKMirrorMod.DoLogError(e);
                    }

            self = @params.self;
            orig(self);
            if (_afterReset != null)
                foreach (Delegates.Reset_AfterArgs toInvoke in _afterReset.GetInvocationList())
                    try
                    {
                        _afterReset.Invoke(@params);
                    }
                    catch (Exception e)
                    {
                        HKMirrorMod.DoLogError(e);
                    }
        }

        internal static void HookReshape()
        {
            if (!HookedList.Contains("Reshape"))
            {
                HookedList.Add("Reshape");
                On.tk2dUILayout.Reshape += Reshape;
            }
        }

        internal static event Delegates.Reshape_BeforeArgs _beforeReshape;
        internal static event Delegates.Reshape_AfterArgs _afterReshape;

        private static void Reshape(On.tk2dUILayout.orig_Reshape orig, tk2dUILayout self, Vector3 dMin, Vector3 dMax,
            bool updateChildren)
        {
            Delegates.Params_Reshape @params = new()
            {
                self = self, dMin = dMin, dMax = dMax, updateChildren = updateChildren
            };
            if (_beforeReshape != null)
                foreach (Delegates.Reshape_BeforeArgs toInvoke in _beforeReshape.GetInvocationList())
                    try
                    {
                        _beforeReshape?.Invoke(@params);
                    }
                    catch (Exception e)
                    {
                        HKMirrorMod.DoLogError(e);
                    }

            self = @params.self;
            dMin = @params.dMin;
            dMax = @params.dMax;
            updateChildren = @params.updateChildren;
            orig(self, dMin, dMax, updateChildren);
            if (_afterReshape != null)
                foreach (Delegates.Reshape_AfterArgs toInvoke in _afterReshape.GetInvocationList())
                    try
                    {
                        _afterReshape.Invoke(@params);
                    }
                    catch (Exception e)
                    {
                        HKMirrorMod.DoLogError(e);
                    }
        }

        internal static void HookSetBounds()
        {
            if (!HookedList.Contains("SetBounds"))
            {
                HookedList.Add("SetBounds");
                On.tk2dUILayout.SetBounds += SetBounds;
            }
        }

        internal static event Delegates.SetBounds_BeforeArgs _beforeSetBounds;
        internal static event Delegates.SetBounds_AfterArgs _afterSetBounds;

        private static void SetBounds(On.tk2dUILayout.orig_SetBounds orig, tk2dUILayout self, Vector3 pMin,
            Vector3 pMax)
        {
            Delegates.Params_SetBounds @params = new()
            {
                self = self, pMin = pMin, pMax = pMax
            };
            if (_beforeSetBounds != null)
                foreach (Delegates.SetBounds_BeforeArgs toInvoke in _beforeSetBounds.GetInvocationList())
                    try
                    {
                        _beforeSetBounds?.Invoke(@params);
                    }
                    catch (Exception e)
                    {
                        HKMirrorMod.DoLogError(e);
                    }

            self = @params.self;
            pMin = @params.pMin;
            pMax = @params.pMax;
            orig(self, pMin, pMax);
            if (_afterSetBounds != null)
                foreach (Delegates.SetBounds_AfterArgs toInvoke in _afterSetBounds.GetInvocationList())
                    try
                    {
                        _afterSetBounds.Invoke(@params);
                    }
                    catch (Exception e)
                    {
                        HKMirrorMod.DoLogError(e);
                    }
        }

        internal static void HookGetMinBounds()
        {
            if (!HookedList.Contains("GetMinBounds"))
            {
                HookedList.Add("GetMinBounds");
                On.tk2dUILayout.GetMinBounds += GetMinBounds;
            }
        }

        internal static event Delegates.GetMinBounds_BeforeArgs _beforeGetMinBounds;
        internal static event Delegates.GetMinBounds_AfterArgs _afterGetMinBounds;

        private static Vector3 GetMinBounds(On.tk2dUILayout.orig_GetMinBounds orig, tk2dUILayout self)
        {
            Delegates.Params_GetMinBounds @params = new()
            {
                self = self
            };
            if (_beforeGetMinBounds != null)
                foreach (Delegates.GetMinBounds_BeforeArgs toInvoke in _beforeGetMinBounds.GetInvocationList())
                    try
                    {
                        _beforeGetMinBounds?.Invoke(@params);
                    }
                    catch (Exception e)
                    {
                        HKMirrorMod.DoLogError(e);
                    }

            self = @params.self;
            var retVal = orig(self);
            if (_afterGetMinBounds != null)
                foreach (Delegates.GetMinBounds_AfterArgs toInvoke in _afterGetMinBounds.GetInvocationList())
                    try
                    {
                        retVal = _afterGetMinBounds.Invoke(@params, retVal);
                    }
                    catch (Exception e)
                    {
                        HKMirrorMod.DoLogError(e);
                    }

            return retVal;
        }

        internal static void HookGetMaxBounds()
        {
            if (!HookedList.Contains("GetMaxBounds"))
            {
                HookedList.Add("GetMaxBounds");
                On.tk2dUILayout.GetMaxBounds += GetMaxBounds;
            }
        }

        internal static event Delegates.GetMaxBounds_BeforeArgs _beforeGetMaxBounds;
        internal static event Delegates.GetMaxBounds_AfterArgs _afterGetMaxBounds;

        private static Vector3 GetMaxBounds(On.tk2dUILayout.orig_GetMaxBounds orig, tk2dUILayout self)
        {
            Delegates.Params_GetMaxBounds @params = new()
            {
                self = self
            };
            if (_beforeGetMaxBounds != null)
                foreach (Delegates.GetMaxBounds_BeforeArgs toInvoke in _beforeGetMaxBounds.GetInvocationList())
                    try
                    {
                        _beforeGetMaxBounds?.Invoke(@params);
                    }
                    catch (Exception e)
                    {
                        HKMirrorMod.DoLogError(e);
                    }

            self = @params.self;
            var retVal = orig(self);
            if (_afterGetMaxBounds != null)
                foreach (Delegates.GetMaxBounds_AfterArgs toInvoke in _afterGetMaxBounds.GetInvocationList())
                    try
                    {
                        retVal = _afterGetMaxBounds.Invoke(@params, retVal);
                    }
                    catch (Exception e)
                    {
                        HKMirrorMod.DoLogError(e);
                    }

            return retVal;
        }

        internal static void HookRefresh()
        {
            if (!HookedList.Contains("Refresh"))
            {
                HookedList.Add("Refresh");
                On.tk2dUILayout.Refresh += Refresh;
            }
        }

        internal static event Delegates.Refresh_BeforeArgs _beforeRefresh;
        internal static event Delegates.Refresh_AfterArgs _afterRefresh;

        private static void Refresh(On.tk2dUILayout.orig_Refresh orig, tk2dUILayout self)
        {
            Delegates.Params_Refresh @params = new()
            {
                self = self
            };
            if (_beforeRefresh != null)
                foreach (Delegates.Refresh_BeforeArgs toInvoke in _beforeRefresh.GetInvocationList())
                    try
                    {
                        _beforeRefresh?.Invoke(@params);
                    }
                    catch (Exception e)
                    {
                        HKMirrorMod.DoLogError(e);
                    }

            self = @params.self;
            orig(self);
            if (_afterRefresh != null)
                foreach (Delegates.Refresh_AfterArgs toInvoke in _afterRefresh.GetInvocationList())
                    try
                    {
                        _afterRefresh.Invoke(@params);
                    }
                    catch (Exception e)
                    {
                        HKMirrorMod.DoLogError(e);
                    }
        }
    }

    /// <summary>
    ///     Contains necessary information to create Hooks. Does not contain any hooks
    /// </summary>
    public static class Delegates
    {
        public delegate int get_ItemCount_AfterArgs(Params_get_ItemCount args, int ret);

        public delegate void get_ItemCount_BeforeArgs(Params_get_ItemCount args);

        public delegate int get_ItemCount_WithArgs(Func<tk2dUILayout, int> orig, tk2dUILayout self);

        public delegate Vector3 GetMaxBounds_AfterArgs(Params_GetMaxBounds args, Vector3 ret);

        public delegate void GetMaxBounds_BeforeArgs(Params_GetMaxBounds args);

        public delegate Vector3 GetMaxBounds_WithArgs(Func<tk2dUILayout, Vector3> orig, tk2dUILayout self);

        public delegate Vector3 GetMinBounds_AfterArgs(Params_GetMinBounds args, Vector3 ret);

        public delegate void GetMinBounds_BeforeArgs(Params_GetMinBounds args);

        public delegate Vector3 GetMinBounds_WithArgs(Func<tk2dUILayout, Vector3> orig, tk2dUILayout self);

        public delegate void Refresh_AfterArgs(Params_Refresh args);

        public delegate void Refresh_BeforeArgs(Params_Refresh args);

        public delegate void Refresh_WithArgs(Action<tk2dUILayout> orig, tk2dUILayout self);

        public delegate void Reset_AfterArgs(Params_Reset args);

        public delegate void Reset_BeforeArgs(Params_Reset args);

        public delegate void Reset_WithArgs(Action<tk2dUILayout> orig, tk2dUILayout self);

        public delegate void Reshape_AfterArgs(Params_Reshape args);

        public delegate void Reshape_BeforeArgs(Params_Reshape args);

        public delegate void Reshape_WithArgs(Action<tk2dUILayout, Vector3, Vector3, bool> orig, tk2dUILayout self,
            Vector3 dMin, Vector3 dMax, bool updateChildren);

        public delegate void SetBounds_AfterArgs(Params_SetBounds args);

        public delegate void SetBounds_BeforeArgs(Params_SetBounds args);

        public delegate void SetBounds_WithArgs(Action<tk2dUILayout, Vector3, Vector3> orig, tk2dUILayout self,
            Vector3 pMin, Vector3 pMax);

        public sealed class Params_get_ItemCount
        {
            public tk2dUILayout self;
        }

        public sealed class Params_Reset
        {
            public tk2dUILayout self;
        }

        public sealed class Params_Reshape
        {
            public Vector3 dMax;
            public Vector3 dMin;
            public tk2dUILayout self;
            public bool updateChildren;
        }

        public sealed class Params_SetBounds
        {
            public Vector3 pMax;
            public Vector3 pMin;
            public tk2dUILayout self;
        }

        public sealed class Params_GetMinBounds
        {
            public tk2dUILayout self;
        }

        public sealed class Params_GetMaxBounds
        {
            public tk2dUILayout self;
        }

        public sealed class Params_Refresh
        {
            public tk2dUILayout self;
        }
    }

    /// <summary>
    ///     Contains Hooks to that run code before orig(self) is called
    /// </summary>
    public static class BeforeOrig
    {
        public static event Delegates.get_ItemCount_BeforeArgs get_ItemCount
        {
            add
            {
                HookHandler._beforeget_ItemCount += value;
                HookHandler.Hookget_ItemCount();
            }
            remove => HookHandler._beforeget_ItemCount -= value;
        }

        public static event Delegates.Reset_BeforeArgs Reset
        {
            add
            {
                HookHandler._beforeReset += value;
                HookHandler.HookReset();
            }
            remove => HookHandler._beforeReset -= value;
        }

        public static event Delegates.Reshape_BeforeArgs Reshape
        {
            add
            {
                HookHandler._beforeReshape += value;
                HookHandler.HookReshape();
            }
            remove => HookHandler._beforeReshape -= value;
        }

        public static event Delegates.SetBounds_BeforeArgs SetBounds
        {
            add
            {
                HookHandler._beforeSetBounds += value;
                HookHandler.HookSetBounds();
            }
            remove => HookHandler._beforeSetBounds -= value;
        }

        public static event Delegates.GetMinBounds_BeforeArgs GetMinBounds
        {
            add
            {
                HookHandler._beforeGetMinBounds += value;
                HookHandler.HookGetMinBounds();
            }
            remove => HookHandler._beforeGetMinBounds -= value;
        }

        public static event Delegates.GetMaxBounds_BeforeArgs GetMaxBounds
        {
            add
            {
                HookHandler._beforeGetMaxBounds += value;
                HookHandler.HookGetMaxBounds();
            }
            remove => HookHandler._beforeGetMaxBounds -= value;
        }

        public static event Delegates.Refresh_BeforeArgs Refresh
        {
            add
            {
                HookHandler._beforeRefresh += value;
                HookHandler.HookRefresh();
            }
            remove => HookHandler._beforeRefresh -= value;
        }
    }

    /// <summary>
    ///     Contains Hooks to that run code after orig(self) is called
    /// </summary>
    public static class AfterOrig
    {
        public static event Delegates.get_ItemCount_AfterArgs get_ItemCount
        {
            add
            {
                HookHandler._afterget_ItemCount += value;
                HookHandler.Hookget_ItemCount();
            }
            remove => HookHandler._afterget_ItemCount -= value;
        }

        public static event Delegates.Reset_AfterArgs Reset
        {
            add
            {
                HookHandler._afterReset += value;
                HookHandler.HookReset();
            }
            remove => HookHandler._afterReset -= value;
        }

        public static event Delegates.Reshape_AfterArgs Reshape
        {
            add
            {
                HookHandler._afterReshape += value;
                HookHandler.HookReshape();
            }
            remove => HookHandler._afterReshape -= value;
        }

        public static event Delegates.SetBounds_AfterArgs SetBounds
        {
            add
            {
                HookHandler._afterSetBounds += value;
                HookHandler.HookSetBounds();
            }
            remove => HookHandler._afterSetBounds -= value;
        }

        public static event Delegates.GetMinBounds_AfterArgs GetMinBounds
        {
            add
            {
                HookHandler._afterGetMinBounds += value;
                HookHandler.HookGetMinBounds();
            }
            remove => HookHandler._afterGetMinBounds -= value;
        }

        public static event Delegates.GetMaxBounds_AfterArgs GetMaxBounds
        {
            add
            {
                HookHandler._afterGetMaxBounds += value;
                HookHandler.HookGetMaxBounds();
            }
            remove => HookHandler._afterGetMaxBounds -= value;
        }

        public static event Delegates.Refresh_AfterArgs Refresh
        {
            add
            {
                HookHandler._afterRefresh += value;
                HookHandler.HookRefresh();
            }
            remove => HookHandler._afterRefresh -= value;
        }
    }

    /// <summary>
    ///     Contains all On Hooks, even those that aren't in the On namespace such as API generated functions and property
    ///     getters/setters
    /// </summary>
    public static class WithOrig
    {
        public static event Delegates.get_ItemCount_WithArgs get_ItemCount
        {
            add => HookEndpointManager.Add<Delegates.get_ItemCount_WithArgs>(
                ReflectionHelper.GetMethodInfo(typeof(tk2dUILayout), "get_ItemCount"), value);
            remove => HookEndpointManager.Remove<Delegates.get_ItemCount_WithArgs>(
                ReflectionHelper.GetMethodInfo(typeof(tk2dUILayout), "get_ItemCount"), value);
        }

        public static event On.tk2dUILayout.hook_Reset Reset
        {
            add => On.tk2dUILayout.Reset += value;
            remove => On.tk2dUILayout.Reset -= value;
        }

        public static event On.tk2dUILayout.hook_Reshape Reshape
        {
            add => On.tk2dUILayout.Reshape += value;
            remove => On.tk2dUILayout.Reshape -= value;
        }

        public static event On.tk2dUILayout.hook_SetBounds SetBounds
        {
            add => On.tk2dUILayout.SetBounds += value;
            remove => On.tk2dUILayout.SetBounds -= value;
        }

        public static event On.tk2dUILayout.hook_GetMinBounds GetMinBounds
        {
            add => On.tk2dUILayout.GetMinBounds += value;
            remove => On.tk2dUILayout.GetMinBounds -= value;
        }

        public static event On.tk2dUILayout.hook_GetMaxBounds GetMaxBounds
        {
            add => On.tk2dUILayout.GetMaxBounds += value;
            remove => On.tk2dUILayout.GetMaxBounds -= value;
        }

        public static event On.tk2dUILayout.hook_Refresh Refresh
        {
            add => On.tk2dUILayout.Refresh += value;
            remove => On.tk2dUILayout.Refresh -= value;
        }
    }
}